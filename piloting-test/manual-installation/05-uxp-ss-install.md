# –Ü–Ω—Å—Ç–∞–ª—è—Ü—ñ—è –ø–∞–∫–µ—Ç–∞ uxp-securityserver-ua —Ç–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (–®–ë–û)


## üîß –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

<span id="access-ports"></span>
### üîê –ü–æ—Ä—Ç–∏ –¥–æ—Å—Ç—É–ø—É


| **–í—Ö—ñ–¥–Ω—ñ –ø–æ—Ä—Ç–∏ (TCP)** | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –û–±–ª–∞—Å—Ç—å –º–µ—Ä–µ–∂—ñ |
| --- | --- | --- |
| 4000 | –í–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –®–ë–û | –ü–†–ò–í–ê–¢–ù–ê |
| 2082 | –°—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Ç–µ—Ä–∞ (–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ª–∏—à–µ —É –≤–∏–ø–∞–¥–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –±–∞–ª–∞–Ω—Å—É–≤–∞–ª—å–Ω–∏–∫–∞ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —â–æ–± —Ä–æ–∑–ø–æ–¥—ñ–ª—è—Ç–∏ –∑–∞–ø–∏—Ç–∏ –º—ñ–∂ –≤—É–∑–ª–∞–º–∏ –∫–ª–∞—Å—Ç–µ—Ä—É —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏) | –ü–†–ò–í–ê–¢–ù–ê |
| 80 | HTTP –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –≤—ñ–¥ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º | –ü–†–ò–í–ê–¢–ù–ê |
| 443 | HTTPS –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –≤—ñ–¥ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º | –ü–†–ò–í–ê–¢–ù–ê |
| 5500 | –û–±–º—ñ–Ω –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –º—ñ–∂ –®–ë–û | –í–Ü–î–ö–†–ò–¢–ê |
<br>

| **–í–∏—Ö—ñ–¥–Ω—ñ –ø–æ—Ä—Ç–∏ (TCP)** | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –û–±–ª–∞—Å—Ç—å –º–µ—Ä–µ–∂—ñ |
| --- | --- | --- |
| 80 | HTTP –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –¥–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º; –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è; –≥–ª–æ–±–∞–ª—å–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è; —ñ–Ω—à—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ | –í–Ü–î–ö–†–ò–¢–ê |
| 443 | HTTPS –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –¥–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º; —ñ–Ω—à—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ | –í–Ü–î–ö–†–ò–¢–ê |
| 514 | –ó‚Äô—î–¥–Ω–∞–Ω–Ω—è Syslog —ñ–∑ —Å–µ—Ä–≤–µ—Ä–æ–º –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è | –ü–†–ò–í–ê–¢–ù–ê |
| 9000 | –ó‚Äô—î–¥–Ω–∞–Ω–Ω—è S3 —ñ–∑ —Å–µ—Ä–≤–µ—Ä–æ–º –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å | –ü–†–ò–í–ê–¢–ù–ê |
| 4400 | –°–µ—Ä–≤—ñ—Å–Ω—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ –ö–æ–Ω–µ–∫—Ç–æ—Ä–∞ UXP (–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ª–∏—à–µ –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –ö–æ–Ω–µ–∫—Ç–æ—Ä–∞ UXP) | –ü–†–ò–í–ê–¢–ù–ê |
| 8080 | –í—ñ–¥–¥–∞–ª–µ–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä—É Zabbix (–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ª–∏—à–µ –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Å–µ—Ä–≤–µ—Ä—É Zabbix –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏ | –ü–†–ò–í–ê–¢–ù–ê |
| 10051 | –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–∏—Ö –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä Zabbix (–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ª–∏—à–µ –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Å–µ—Ä–≤–µ—Ä—É Zabbix –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏ | –ü–†–ò–í–ê–¢–ù–ê |
| 9200 | –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä Elasticsearch (RESTful API) (–Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ª–∏—à–µ –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Å–µ—Ä–≤–µ—Ä—É Elasticsearch –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏ | –ü–†–ò–í–ê–¢–ù–ê |
| 5500 | –û–±–º—ñ–Ω –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –±–µ–∑–ø–µ–∫–∏ | –í–Ü–î–ö–†–ò–¢–ê |
| 4001 | –ó–∞–ø–∏—Ç–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó | –í–Ü–î–ö–†–ò–¢–ê |

---

## üîπ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –®–ë–û

1. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ ```HOSTNAME```

```bash
hostname -A
sudo hostnamectl set-hostname <your-hostname>
```

> ‚ÑπÔ∏è **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ù–∞–∑–≤–∞ —Ö–æ—Å—Ç–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤—É–∑–ª–∞. –í–æ–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó.


2. –ó–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó:

```bash
sudo sed -i 's/^[A-Za-z0-9]/#&/' /etc/apt/sources.list
```
3. –î–æ–¥–∞–π—Ç–µ GPG-–∫–ª—é—á –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

```bash
wget -O - https://project-repo.trembita.gov.ua:8081/public-keys/public.key.txt | sudo apt-key add -
```
4. –î–æ–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:

```bash
echo 'deb https://project-repo.trembita.gov.ua:8081/repository/t2-stack-1.22.7/ jammy main' | sudo tee -a /etc/apt/sources.list
```
5. –û–Ω–æ–≤—ñ—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç—ñ–≤:

```bash
sudo apt update
```
6. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –®–ë–û

```bash
sudo apt install uxp-securityserver-trembita
```
---

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥ —á–∞—Å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –®–ë–û

–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É ```sudo apt install uxp-securityserver-trembita``` –≤–∏–∫–æ–Ω–∞–π—Ç–µ —Ç–∞–∫—ñ –¥—ñ—ó —É –≥—Ä–∞—Ñ—ñ—á–Ω–æ–º—É —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä—ñ:

1. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Y``` –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è
2. –í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω/–ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:
<br>

![](05-uxp-ss-install-image/image11.png) 
<br>

![](05-uxp-ss-install-image/image12.png)

3. –ù–∞ –µ–∫—Ä–∞–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ MinIO:

3.1. –û–±–µ—Ä—ñ—Ç—å ```No```, —è–∫—â–æ MinIO —â–µ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π. –£ —Ü—å–æ–º—É —Ä–∞–∑—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ –≤ ```local.ini``` –Ω–∞ –®–ë–û
<br>

![](05-uxp-ss-install-image/image13.png)

3.2. –Ø–∫—â–æ MinIO –≤–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π —ñ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Yes``` —ñ –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:

- ```IP-–∞–¥—Ä–µ—Å–∞ MinIO``` –∑ –ø–æ—Ä—Ç–æ–º ```9000```
<br>

![](05-uxp-ss-install-image/image14.png)

- –®–ª—è—Ö –¥–æ –ø–∞–ø–∫–∏ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—ñ–≤
<br>

![](05-uxp-ss-install-image/image15.png)

- ```Access Key``` –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ MinIO
<br>

![](05-uxp-ss-install-image/image16.png)

- ```Secret Key```
<br>

![](05-uxp-ss-install-image/image17.png)

–®–ª—è—Ö –¥–æ TLS-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É, –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ–≥–æ –¥–ª—è MinIO
<br>

![](05-uxp-ss-install-image/image18.png)

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```–û–ö```
<br>

![](05-uxp-ss-install-image/image19.png)

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```–û–ö``` —â–µ –¥–≤—ñ—á—ñ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó
<br>

![](05-uxp-ss-install-image/image20.png)

---

## üîπ –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ (AIDE)

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å AIDE

```bash
sudo apt install uxp-integrity-securityserver
```

2. –ü–æ—Å—Ç–∞–≤—Ç–µ –π–æ–≥–æ –Ω–∞ –ø–∞—É–∑—É:

```bash
sudo uxp-integrity pause
```

3. –î–æ–¥–∞–π—Ç–µ IP-–∞–¥—Ä–µ—Å—É ```–ê–¥–º—ñ–Ω —Å—Ç–∞–Ω—Ü—ñ—ó``` –¥–æ —Å–ø–∏—Å–∫—É –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö:

```bash
sudo nano /etc/uxp/nginx/allowed_hosts.conf
```

4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å nginx:

```bash
sudo nginx -t
```

5. –Ø–∫—â–æ –ø–æ–º–∏–ª–æ–∫ –Ω–µ–º–∞—î ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å nginx:

```bash
sudo service nginx restart
```

6. –û–Ω–æ–≤—ñ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Ö–µ—à—ñ:

```bash
sudo uxp-integrity update
```

7. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å —É—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ ```UXP```:

```bash
sudo systemctl status uxp-*
```
---
<br>

> üí° **–ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ:**
>
> ‚Ä¢ –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ (—É —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏ –≤—Å—ñ —Å–ª—É–∂–±–∏ –±—É–¥—É—Ç—å –∑—É–ø–∏–Ω–µ–Ω—ñ):
> ```bash
> sudo uxp-integrity check
> ```
> ‚Ä¢ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ö–µ—à—É –±–∞–∑(–∏) –¥–∞–Ω–∏—Ö AIDE:
> ```bash
> sudo uxp-integrity update
> ```
>
> ‚Ä¢ –ü—Ä–∏–∑—É–ø–∏–Ω–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –Ω–∞ 30 —Ö–≤–∏–ª–∏–Ω (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ check –±—É–¥—É—Ç—å —ñ–≥–Ω–æ—Ä—É–≤–∞—Ç–∏—Å—è):
> ```bash
> sudo uxp-integrity pause
> ```
> 
> ‚Ä¢ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤:
> ```bash
> sudo uxp-integrity status
> ```
>
> ‚Ä¢ –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø—ñ—Å–ª—è –ø–∞—É–∑–∏:
> ```bash
> sudo uxp-integrity start
> ```
> 
> ‚Ä¢ –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤ —ñ —Å–µ—Ä–≤—ñ—Å—ñ–≤:
> ```bash
> sudo uxp-integrity list
> ```
>
> ‚Ä¢ –ó—É–ø–∏–Ω–∫–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤:
> ```bash
> sudo uxp-integrity stop
> ```

<br>

---

## üîπ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É —Å–µ—Ä–≤—ñ—Å—ñ–≤ UXP
–°–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—å –∫–æ–º–∞–Ω–¥–æ—é:

```bash
systemctl list-units -t service "uxp-*"
```

| –°–µ—Ä–≤—ñ—Å                                   | –°—Ç–∞–Ω   | –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å | –°—Ç–∞—Ç—É—Å       | –û–ø–∏—Å                            |
| ---------------------------------------- | ------ | ---------- | ------------ | ------------------------------- |
| `uxp-confclient.service`                 | loaded | active     | running      | UXP Global Configuration Client |
| `uxp-identity-provider-rest-api.service` | loaded | active     | running      | UXP Identity Provider           |
| `uxp-integrity.service`                  | loaded | active     | running      | UXP Integrity checker           |
| `uxp-messagelog-archiver.service`        | loaded | active     | running      | UXP Messagelog Archiver         |
| `uxp-monitor.service`                    | loaded | active     | running      | UXP Proxy Monitor               |
| `uxp-ocsp-cache.service`                 | loaded | active     | running      | UXP OCSP Cache                  |
| `uxp-proxy.service`                      | loaded | activating | auto-restart | UXP Message Proxy               |
| `uxp-securityserver-rest-api.service`    | loaded | active     | running      | UXP Security Server REST API    |
| `uxp-verifier-rest-api.service`          | loaded | active     | running      | UXP Verifier REST API           |


> ‚ÑπÔ∏è **–ü—Ä–∏–º—ñ—Ç–∫–∞:**  –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–≤–∞–∂–∞—î—Ç—å—Å—è —É—Å–ø—ñ—à–Ω–∏–º, —è–∫—â–æ —Å–µ—Ä–≤—ñ—Å–∏ —Å–∏—Å—Ç–µ–º–∏ ```UXP``` –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—è —ñ –¥–æ—Å—Ç—É–ø–Ω–∏–π –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–æ—Ä—Ç—ñ–≤

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–ª–∏ —Å–≤—ñ–π –º–µ—Ä–µ–∂–µ–≤–∏–π –µ–∫—Ä–∞–Ω –Ω–∞ –¥–æ–∑–≤—ñ–ª –ª–∏—à–µ –≤—Ö—ñ–¥–Ω–∏—Ö –∑‚Äô—î–¥–Ω–∞–Ω—å —á–µ—Ä–µ–∑ TCP –ø–æ—Ä—Ç–∏, —è–∫ –≤–∫–∞–∑–∞–Ω–æ —É —Ä–æ–∑–¥—ñ–ª—ñ [üîê –ü–æ—Ä—Ç–∏ –¥–æ—Å—Ç—É–ø—É](#access-ports). –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤ –∑ —Ä—ñ–∑–Ω–∏—Ö –∑–æ–Ω –¥–æ—Å—Ç—É–ø—É (—ñ–∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó –º–µ—Ä–µ–∂—ñ, –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –ø—ñ–¥–º–µ—Ä–µ–∂—ñ, –∞ —Ç–∞–∫–æ–∂ –∑ —Ä–æ–±–æ—á–æ–≥–æ –º—ñ—Å—Ü—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞, —â–æ–± —Ü—ñ–ª–∫–æ–º –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–æ –∫–æ—Ä–µ–∫—Ç–Ω–æ):

```bash
nmap --open <IP-security-server>
```

üîπ –ó–æ–≤–Ω—ñ—à–Ω—è –º–µ—Ä–µ–∂–∞: –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –ª–∏—à–µ –ø–æ—Ä—Ç TCP 5500 (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)

üîπ –í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø—ñ–¥–º–µ—Ä–µ–∂–∞: –ø–æ—Ä—Ç–∏ 80, 443, 2082, 5500

üîπ –†–æ–±–æ—á–∞ —Å—Ç–∞–Ω—Ü—ñ—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞: —Ç–∞–∫–æ–∂ –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø–æ—Ä—Ç 4000

> ‚ö†Ô∏è **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –Ø–∫—â–æ –≤–∏ –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä –∞–±–æ –±–∞–ª–∞–Ω—Å—É–≤–∞–ª—å–Ω–∏–∫, –ø–æ—Ä—Ç 2082 –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–∫—Ä–∏—Ç–∏–º


3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤

–î–æ—Å—Ç—É–ø –ª–∏—à–µ –¥–ª—è ```sudo``` –∞–±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ```uxp```, —è–∫–∏–π:

- —î –≤–ª–∞—Å–Ω–∏–∫–æ–º —É—Å—ñ—Ö —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ —ñ –ª–æ–≥—ñ–≤; <br>
- –Ω–µ –º–∞—î –º–µ—Ç–æ–¥—ñ–≤ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó; <br>
- –Ω–µ –º–∞—î —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É —Å–≤–æ—ó–π –≥—Ä—É–ø—ñ. <br>

–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ:

| –®–ª—è—Ö                       | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è          |
|----------------------------|----------------------|
| `/etc/uxp/`                | –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ |
| `/var/lib/uxp/messagelog/` | –ñ—É—Ä–Ω–∞–ª–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å  |
| `/var/lib/uxp/backup/`     | –†–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó       |

>  ‚úÖ **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –Ø–∫—â–æ –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ UXP –∞–∫—Ç–∏–≤–Ω—ñ, –ø–æ—Ä—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –∑–æ–Ω—ñ –¥–æ—Å—Ç—É–ø—É, –∞ –ø—Ä–∞–≤–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∫–æ—Ä–µ–∫—Ç–Ω–æ ‚Äî —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ. –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –¥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —É –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ.



---
<span id="aparatni-tokeny"></span>

## üîπ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ –®–ë–û –∑–±–µ—Ä—ñ–≥–∞—î –∫–ª—é—á—ñ –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–º—É —Ç–æ–∫–µ–Ω—ñ (—Ñ–∞–π–ª–æ–≤–æ–º—É), —è–∫–∏–π —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó.

> üîê **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ö–ª—é—á—ñ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ TLS –∑–∞–≤–∂–¥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–º—É —Ç–æ–∫–µ–Ω—ñ.

1. –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –∑–∞—Å–æ–±–∏ –∫–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É/–ø–µ—á–∞—Ç–∫–∏ (–ø—Ä–∏—Å—Ç—Ä–æ—ó):
   
HSM:

üü¢ –Ü–Ü–¢ –ì—Ä—è–¥–∞-301 <br>
üü¢ –®–∏—Ñ—Ä-HSM <br>

–¢–æ–∫–µ–Ω–∏:

üü¢ –ê–≤—Ç–æ—Ä SecureToken-338 <br>
üü¢ –Ü–Ü–¢ –ê–ª–º–∞–∑-1–ö <br>


2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –¥—Ä–∞–π–≤–µ—Ä—ñ–≤ (–¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤)

–ü–æ—Å—Ç–∞–≤—Ç–µ AIDE –Ω–∞ –ø–∞—É–∑—É:

```bash
sudo uxp-integrity pause
```

–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–º–∏ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏ –Ω–∞ Ubuntu:

```bash
sudo apt install pcscd libccid pcsc-tools libpcsclite1 opensc
```

–ü—Ä–∏—î–¥–Ω–∞–π—Ç–µ –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ Ubuntu –∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º –®–ë–û.

–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –Ω–∞ –®–ë–û –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≤—ñ–¥ –≤–∏—Ä–æ–±–Ω–∏–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é: <br>
- [–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ü–Ü–¢ –ì—Ä—è–¥–∞-301](#iit-gryada301) <br> 
- [–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –®–∏—Ñ—Ä-HSM](#cipher-hsm) <br>
- [–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ê–≤—Ç–æ—Ä SecureToken-338](#avtor-338)  <br>
- [–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ü–Ü–¢ –ê–ª–º–∞–∑-1–ö](#almaz-1k)  <br>

---

<span id="iit-gryada301"></span>

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ü–Ü–¢ –ì—Ä—è–¥–∞-301

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–∞–∫–µ—Ç –¥—Ä–∞–π–≤–µ—Ä—ñ–≤ PKCS#11 ```NCMGryada301PKCS11Libs-Linux.zip``` —ñ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

```bash
sudo wget https://project-repo.trembita.gov.ua:8081/files/t2/NCMGryada301PKCS11Libs-Linux.zip
```
   
2. –†–æ–∑–ø–∞–∫—É–π—Ç–µ —Ñ–∞–π–ª–∏ —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é ```/usr/share/uxp/lib/``` :

```bash
sudo unzip -o -j NCMGryada301PKCS11Libs-Linux.zip -d /usr/share/uxp/lib/
```

3. –ó–∞–¥–∞–π—Ç–µ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown root:root /usr/share/uxp/lib/*.so
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo chmod 644 /usr/share/uxp/lib/*.so
```

4. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó `/usr/share/uxp/lib/osplm.ini`:

```bash
[\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301]
[\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301\Modules]
[\SOFTWARE\Institute of Informational Technologies\Key Medias\NCM Gryada-301\Modules\<serial-number>]

OrderNumber=0
SN=<serial-number>
Address=<device-address>
AddressMask=<address-mask>
```

>  üõ† **–ü—Ä–∏–º—ñ—Ç–∫–∞:**  –ó–∞–º—ñ—Å—Ç—å: <br>
>  ```<serial-number>``` (—É –¥–≤–æ—Ö –º—ñ—Å—Ü—è—Ö) –≤–∫–∞–∂—ñ—Ç—å –æ—Å—Ç–∞–Ω–Ω—ñ —Ç—Ä–∏ **—Å–∏–º–≤–æ–ª–∏** —Å–µ—Ä—ñ–π–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –ì—Ä—è–¥–∞-301. <br> 
>  ```<device-address>``` —ñ ```<address-mask>``` ‚Äî IP-–∞–¥—Ä–µ—Å—É –ø—Ä–∏—Å—Ç—Ä–æ—é –≤ –º–µ—Ä–µ–∂—ñ —Ç–∞ –º–∞—Å–∫—É –ø—ñ–¥–º–µ—Ä–µ–∂—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 255.255.255.0), –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ.


5. –ó–∞–¥–∞–π—Ç–µ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ ```osplm.ini```

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown root:root /usr/share/uxp/lib/osplm.ini
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo chmod 644 /usr/share/uxp/lib/osplm.ini
```

6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏:

```bash
sudo systemctl restart uxp-securityserver-rest-api uxp-proxy
```

7. –û–Ω–æ–≤—ñ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Ö–µ—à—ñ AIDE

```bash
sudo uxp-integrity update
```

> ‚úÖ **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ü–æ–¥–∞–ª—å—à—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª—é—á–∞ –π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –®–ë–û.

---

<span id="cipher-hsm"></span>

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –®–∏—Ñ—Ä-HSM

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–∞–∫–µ—Ç –¥—Ä–∞–π–≤–µ—Ä—ñ–≤ PKCS#11 ```libcihsm.so``` —ñ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

```bash
sudo wget https://project-repo.trembita.gov.ua:8081/files/t2/libcihsm.so
```
   
2. –ü–µ—Ä–µ–º—ñ—Å—Ç—ñ—Ç—å —Ñ–∞–π–ª–∏ —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é ```/usr/share/uxp/lib/``` :

```bash
sudo mv libcihsm.so /usr/share/uxp/lib/
```

3. –ó–∞–¥–∞–π—Ç–µ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown root:root /usr/share/uxp/lib/libcihsm.so
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo chmod 644 /usr/share/uxp/lib/libcihsm.so
```

4. –í–∏–∑–Ω–∞—á—Ç–µ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ ```PKCS11_PROXY_SOCKET``` —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–æ–º—É —Ñ–∞–π–ª—ñ ```/etc/uxp/services/local.conf```, –∑–∞–º—ñ–Ω–∏–≤—à–∏ ```<proxy-address>``` —ñ ```<proxy-port>``` –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏:

```bash
export PKCS11_PROXY_SOCKET="tcp://<proxy-address>:<proxy-port>"
```
> üîê **–ü—Ä–∏–∫–ª–∞–¥:** tcp://10.0.0.5:5657

5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏:

```bash
sudo systemctl restart uxp-securityserver-rest-api uxp-proxy
```

6. –û–Ω–æ–≤—ñ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Ö–µ—à—ñ AIDE:

```bash
sudo uxp-integrity update
```

> ‚úÖ **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ü–æ–¥–∞–ª—å—à—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª—é—á–∞ –π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –®–ë–û.
 
---

<span id="avtor-338"></span>

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ê–≤—Ç–æ—Ä SecureToken-338

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–∞–∫–µ—Ç –¥—Ä–∞–π–≤–µ—Ä—ñ–≤ PKCS#11 ```libav337p11d.so``` —ñ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

```bash
sudo wget https://project-repo.trembita.gov.ua:8081/files/t2/libav337p11d.so
```
   
2. –ü–µ—Ä–µ–º—ñ—Å—Ç—ñ—Ç—å —Ñ–∞–π–ª–∏ —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é ```/usr/share/uxp/lib/``` :

```bash
sudo mv libav337p11d.so /usr/share/uxp/lib/
```

3. –ó–∞–¥–∞–π—Ç–µ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown root:root /usr/share/uxp/lib/libav337p11d.so
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo chmod 644 /usr/share/uxp/lib/libav337p11d.so
```

> ‚úÖ **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ü–æ–¥–∞–ª—å—à—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª—é—á–∞ –π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –®–ë–û.

---

<span id="almaz-1k"></span>

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ü–Ü–¢ –ê–ª–º–∞–∑-1–ö

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–∞–∫–µ—Ç –¥—Ä–∞–π–≤–µ—Ä—ñ–≤ PKCS#11 ```EKAlmaz1CPKCS11Libs-Linux.zip``` —ñ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

```bash
sudo wget https://project-repo.trembita.gov.ua:8081/files/t2/EKAlmaz1CPKCS11Libs-Linux.zip
```
   
2. –†–æ–∑–ø–∞–∫—É–π—Ç–µ —Ñ–∞–π–ª–∏ —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é ```/usr/share/uxp/lib/``` :

```bash
sudo unzip -o -j EKAlmaz1CPKCS11Libs-Linux.zip -d /usr/share/uxp/lib/
```

3. –ó–∞–¥–∞–π—Ç–µ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown root:root /usr/share/uxp/lib/*.so
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo chmod 644 /usr/share/uxp/lib/*.so
```

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏:

```bash
sudo systemctl restart uxp-securityserver-rest-api uxp-proxy
```

5. –û–Ω–æ–≤—ñ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Ö–µ—à—ñ AIDE

```bash
sudo uxp-integrity update
```

> ‚úÖ **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ü–æ–¥–∞–ª—å—à—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª—é—á–∞ –π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –®–ë–û.

---

## ‚ùå –ù–µ–º–æ–∂–ª–∏–≤–æ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—å –≤ –®–ë–û

–Ø–∫—â–æ –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –≤—Ö–æ–¥—É –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∑ º—è–≤–ª—è—î—Ç—å—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ¬´–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó¬ª, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∂—É—Ä–Ω–∞–ª –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:

```bash
sudo tail -f /var/log/uxp/identity-provider-rest-api.log
```

–Ø–∫—â–æ –≤ –∂—É—Ä–Ω–∞–ª—ñ –∑–≥–∞–¥—É—î—Ç—å—Å—è –ø–æ–º–∏–ª–∫–∞ ```redirect_uri```, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

```bash
OAuth2AuthorizationCodeRequestAuthenticationException: OAuth 2.0 Parameter: redirect_uri
```

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ —î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç –º—ñ–∂ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ```redirect_uri``` (–≤–∫–∞–∑–∞–Ω–∏–º —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó ```OAuth```) —Ç–∞ —Ñ–∞–∫—Ç–∏—á–Ω–æ—é –ø—É–±–ª—ñ—á–Ω–æ—é –∞–¥—Ä–µ—Å–æ—é —Å–µ—Ä–≤–µ—Ä–∞ –±–µ–∑–ø–µ–∫–∏ (–±—ñ–ª–∞ –Ü–†-–∞–¥—Ä–µ—Å–∞).

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Ç–æ—á–Ω—É –∞–¥—Ä–µ—Å—É —Å–µ—Ä–≤–µ—Ä–∞:

–Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è DNS-—ñ–º º—è:

```bash
hostname -A
```

–Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è IP-–∞–¥—Ä–µ—Å–∞:

```bash
hostname -I
```

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ ```redirect_uri``` —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö:

```bash
sudo -u postgres -H -- psql -d identity-provider -c "SELECT redirect_uris FROM oauth2_client;"
```

–Ø–∫—â–æ ```redirect_uri``` –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –¥—ñ–π—Å–Ω—ñ–π –ø—É–±–ª—ñ—á–Ω—ñ–π –∞–¥—Ä–µ—Å—ñ —Å–µ—Ä–≤–µ—Ä—É ‚Äî –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–Ω–µ—Å—Ç–∏ –∑–º—ñ–Ω–∏ —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª:

3. –ü—Ä–∏–∑—É–ø–∏–Ω—ñ—Ç—å AIDE

```bash
sudo uxp-integrity update
```
  
4. –û–Ω–æ–≤—ñ—Ç—å –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é ```/etc/uxp/conf.d/local.ini```:

```bash
[identity-provider]
hostname=<–ø—Ä–∏–≤–∞—Ç–Ω–∞-–∞–¥—Ä–µ—Å–∞>
```

> ‚ùå **–Ø–∫—â–æ** —Ü–µ —Ç–µ–∂ –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ, –∞–±–æ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü—ñ—è uri –Ω–µ —Å—Ç–æ—Å—É—î—Ç—å—Å—è –Ω–∞–∑–≤–∏ —Ö–æ—Å—Ç—É —É –≤–∞—à—ñ–π –º–µ—Ä–µ–∂—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü—ñ—ó uri –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º public-client redirect-uris configuration.
> ```bash
> [identity-provider]
> public-client-redirect-uris=https://<–ø—Ä–∏–≤–∞—Ç–Ω–∞-–∞–¥—Ä–µ—Å–∞>:4000
> ```

5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:

```bash
sudo systemctl restart uxp-identity-provider-rest-api
```

---

## ‚ùå –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É —É PostgreSQL

–ü—ñ—Å–ª—è —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏ —É –∂—É—Ä–Ω–∞–ª—ñ PostgreSQL –º–æ–∂–µ –∑ º—è–≤–∏—Ç–∏—Å—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:

```bash
ERROR: relation "public.databasechangeloglock" does not exist at character 22
```

–¶–µ ‚Äî —Ç–∏–ø–æ–≤–µ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö. –ô–æ–≥–æ –º–æ–∂–Ω–∞ —ñ–≥–Ω–æ—Ä—É–≤–∞—Ç–∏, –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥—ñ–π –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.
