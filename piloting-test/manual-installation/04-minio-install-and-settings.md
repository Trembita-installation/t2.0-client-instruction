# –Ü–Ω—Å—Ç–∞–ª—è—Ü—ñ—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ö–æ–≤–∏—â–∞ S3 (MinIO) –¥–ª—è –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
MinIO ‚Äî —Ü–µ –æ–±‚Äô—î–∫—Ç–Ω–µ —Å—Ö–æ–≤–∏—â–µ, —Å—É–º—ñ—Å–Ω–µ –∑ API Amazon S3. –ô–æ–≥–æ –º–æ–∂–Ω–∞ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ —è–∫ —É –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, —Ç–∞–∫ —ñ –≤ —Ö–º–∞—Ä—ñ. –°–µ—Ä–≤–µ—Ä –±–µ–∑–ø–µ–∫–∏ UXP –ø—ñ–¥—Ç—Ä–∏–º—É—î –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ S3 API, —Ç–æ–º—É –º–æ–∂–µ –∞—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É MinIO.


## üîß –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### üì¶ –°—Ö–æ–≤–∏—â–µ

- –ù–∞–∫–æ–ø–∏—á—É–≤–∞—á—ñ –∑ —Ñ–∞–π–ª–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é `XFS`, –æ—Å–∫—ñ–ª—å–∫–∏ XFS —î –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—é, –∂—É—Ä–Ω–∞–ª—å–æ–≤–∞–Ω–æ—é —Ñ–∞–π–ª–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é, —Å–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–æ—é –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö –æ–±‚Äô—î–º—ñ–≤ –¥–∞–Ω–∏—Ö.
- –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è —É –≤–∏–≥–ª—è–¥—ñ `/mnt/drive-1`, `/mnt/drive-2`, ..., `/mnt/drive-n`. MinIO –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –Ω–æ—Ç–∞—Ü—ñ—é —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Go {x...y} –¥–ª—è –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—ó —Å–µ—Ä—ñ—ó –Ω–∞–∫–æ–ø–∏—á—É–≤–∞—á—ñ–≤ –ø—Ä–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—ñ –Ω–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏, –∫–æ–ª–∏ —É—Å—ñ –≤—É–∑–ª–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –º–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–∫–æ–ø–∏—á—É–≤–∞—á—ñ–≤. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ —à–ª—è—Ö–∏ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–∫–æ–ø–∏—á—É–≤–∞—á—ñ–≤ —É –≤–∏–≥–ª—è–¥—ñ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—ó —Å–µ—Ä—ñ—ó, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É —Ç–∞–∫–æ—ó –Ω–æ—Ç–∞—Ü—ñ—ó.
- –ó–∞–ø–∏—Å–∏ –≤ `/etc/fstab`, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —É–Ω—ñ—Ñ—ñ–∫–∞—Ü—ñ—é –Ω–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–æ—á–æ–∫ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–∫–æ–ø–∏—á—É–≤–∞—á—ñ–≤ –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—É–∑–ª—ñ–≤ —Å–∏—Å—Ç–µ–º–∏.
- **‚ö†Ô∏è** MinIO –ø–æ—Ç—Ä–µ–±—É—î –º–æ–Ω–æ–ø–æ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∏—Å–∫—ñ–≤. –ñ–æ–¥–Ω–∏–π —ñ–Ω—à–∏–π –ø—Ä–æ—Ü–µ—Å, –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è, —Å–∫—Ä–∏–ø—Ç–∏ —á–∏ —Ñ—ñ–∑–∏—á–Ω—ñ –æ—Å–æ–±–∏ –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –Ω—ñ—è–∫—ñ –¥—ñ—ó –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ —ñ–∑ —Ä–æ–∑–¥—ñ–ª–æ–º –∞–±–æ –Ω–∞–∫–æ–ø–∏—á—É–≤–∞—á–µ–º, –Ω–∞–¥–∞–Ω–∏–º —É —Ä–æ–∑–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è MinIO, –∞–±–æ —ñ–∑ –æ–±‚Äô—î–∫—Ç–∞–º–∏ —á–∏ —Ñ–∞–π–ª–∞–º–∏, —è–∫—ñ MinIO –∑–±–µ—Ä—ñ–≥–∞—î —Ç–∞–º.
- 10% –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É —Ä–µ–∑–µ—Ä–≤—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ MinIO –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ —Å–µ—Ä–≤—ñ—Å—É (–≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏, –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è, –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è). –¶–µ–π –æ–±—Å—è–≥ –Ω–µ –≤—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è —É –≤–∏–¥—ñ–ª–µ–Ω—ñ –∫–≤–æ—Ç–∏ bucket-—ñ–≤.

### üíª –û–ø–µ—Ä–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞

- Ubuntu Server 22.04 LTS

### üîê –ü–æ—Ä—Ç–∏ –¥–æ—Å—Ç—É–ø—É

| –ü–æ—Ä—Ç | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –û–±–ª–∞—Å—Ç—å |
|------|-------------|---------|
| 9000 | API MinIO   | –ü—Ä–∏–≤–∞—Ç–Ω–∞ |
| 9001 | Web Console | –ü—Ä–∏–≤–∞—Ç–Ω–∞ |

> üîí **–ü—Ä–∏–º—ñ—Ç–∫–∞: ** –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ –ø–æ—Ä—Ç–∏ –ª–∏—à–µ —É –º–µ–∂–∞—Ö –ø—Ä–∏–≤–∞—Ç–Ω–æ—ó –º–µ—Ä–µ–∂—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ª–æ–∫–∞–ª—å–Ω–æ—ó –º–µ—Ä–µ–∂—ñ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó). –£–Ω–∏–∫–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–æ—Ä—Ç—ñ–≤ –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –º–µ—Ä–µ–∂ (–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É), —è–∫—â–æ —Ü–µ –Ω–µ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–æ —Å—Ü–µ–Ω–∞—Ä—ñ—î–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è. –¶–µ –º—ñ–Ω—ñ–º—ñ–∑—É—î —Ä–∏–∑–∏–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É —Ç–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏—Ö –∞—Ç–∞–∫.
---

## üîπ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –ó–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó:

```bash
sudo sed -i 's/^[A-Za-z0-9]/#&/' /etc/apt/sources.list
```
2. –î–æ–¥–∞–π—Ç–µ GPG-–∫–ª—é—á –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

```bash
wget -O - https://project-repo.trembita.gov.ua:8081/public-keys/public.key.txt | sudo apt-key add -
```
3. –î–æ–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:

```bash
echo 'deb https://project-repo.trembita.gov.ua:8081/repository/tr-2-pre-final/ jammy main' | sudo tee -a /etc/apt/sources.list
```
4. –û–Ω–æ–≤—ñ—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç—ñ–≤:

```bash
sudo apt update
```

## üîπ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è MinIO

1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞ MinIO —Ç–∞ —É—Ç–∏–ª—ñ—Ç—É MinIO certgen –¥–ª—è –≥–µ–Ω–µ—Ä—É–≤–∞–Ω–Ω—è —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É:

> ‚ÑπÔ∏è **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –Ø–∫—â–æ –º–∞—î—Ç–µ –Ω–∞–º—ñ—Ä –∑–∞–º—ñ—Å—Ç—å —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –≤–∏–¥–∞–Ω–∏–π —Ü–µ–Ω—Ç—Ä–æ–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (CA), —É—Ç–∏–ª—ñ—Ç—É MinIO certgen –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

```bash
sudo apt install minio certgen
```

2. –°—Ç–≤–æ—Ä—ñ—Ç—å –≥—Ä—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –Ω–∞–∑–≤–æ—é ```minio-user``` —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

```bash
sudo groupadd -r minio-user
```

```bash
sudo useradd -m -r -g minio-user minio-user
```

3. –ó–∞–¥–∞–π—Ç–µ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–ª—è —Å—Ö–æ–≤–∏—â–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, ```/mnt/disk1, /mnt/disk2, /mnt/disk3, /mnt/disk4```):

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown minio-user:minio-user /mnt/data
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo chmod 770 /mnt/data
```

4. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª /etc/default/minio –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (user, password, volumes)

```bash
sudo nano /etc/default/minio
```

***–∑—ñ –∑–º—ñ—Å—Ç–æ–º –Ω–∞ –∑—Ä–∞–∑–æ–∫ —Ç–∞–∫–æ–≥–æ:***
> ‚ÑπÔ∏è –î–µ –∑–∞–¥–∞—î–º–æ –∞–¥–º—ñ–Ω –¥–æ—Å—Ç—É–ø –¥–æ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—ñ ```MINIO_ROOT_USER``` ```MINIO_ROOT_PASSWORD```

```bash
# MINIO_ROOT_USER and MINIO_ROOT_PASSWORD sets the root account for the MinIO server.
# This user has unrestricted permissions to perform S3 and administrative API
# operations on any resource in the deployment.
MINIO_ROOT_USER=minio
MINIO_ROOT_PASSWORD=********

# MINIO_VOLUMES sets the storage volumes or paths to use for the MinIO server.
# The specified path uses MinIO expansion notation to denote a sequential series
# of drives between 1 and 4, inclusive.
# All drives or paths included in the expanded drive list must exist *and* be empty
# or freshly formatted for MinIO to start successfully.
#
# Examples:
#
# Single drive.
# MINIO_VOLUMES="/mnt/data"
#
# 4 sequential series of drives between 1 and 4, inclusive.
# MINIO_VOLUMES="/mnt/data-{1...4}"
MINIO_VOLUMES="/mnt/data"

# MINIO_OPTS sets any additional command-line options to pass to the MinIO server.
# For example, `--console-address :9001` sets the MinIO Console listen port.
MINIO_OPTS="--console-address :9001"
```

5. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø—Ä–∞–≤–∞ –Ω–∞ ```/etc/default/minio```

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown root:minio-user /etc/default/minio
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo chmod 660 /etc/default/minio
```
6. MinIO –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–∫—Ç–∏–≤—É—î TLS 1.3 –ø—ñ—Å–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —á–∏–Ω–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ public.crt —ñ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ private.key —É –∫–∞—Ç–∞–ª–æ–∑—ñ ${HOME}/.minio/certs.
–û—Ç—Ä–∏–º–∞–π—Ç–µ TLS-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –æ–¥–Ω–∏–º —ñ–∑ —Å–ø–æ—Å–æ–±—ñ–≤:
- –≤—ñ–¥ –∑–∞–≥–∞–ª—å–Ω–æ–≤–∏–∑–Ω–∞–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (CA),
- –≤—ñ–¥ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –∞–±–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ CA,
- –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —É—Ç–∏–ª—ñ—Ç–∏ certgen.

–°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π TLS-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –º–æ–∂–Ω–∞ —Ç–∞–∫:

```bash
certgen -ecdsa-curve P256 -host "192.168.1.100, minio.server.dns.name" \
-duration 876000h -org-name "My Organization"
```

> ‚ÑπÔ∏è **–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**
> 
> **192.168.1.100, minio.server.dns.name** ‚Äî IP-–∞–¥—Ä–µ—Å–∞ —Ç–∞ DNS-—ñ–º‚Äô—è —Å–µ—Ä–≤–µ—Ä–∞ MinIO <br>
> **My Organization** ‚Äî –Ω–∞–∑–≤–∞ –≤–∞—à–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó <br>
> **876000h** ‚Äî —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ (~100 —Ä–æ–∫—ñ–≤)

7. –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è TLS-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤:

```bash
sudo -u minio-user mkdir -m 770 -p /home/minio-user/.minio/certs
```

8. –°–∫–æ–ø—ñ—é–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —ñ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á —É —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥:

```bash
sudo cp public.crt private.key /home/minio-user/.minio/certs
```

9. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ —Ñ–∞–π–ª—ñ–≤:

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo bash -c 'chown minio-user:minio-user /home/minio-user/.minio/certs/*'
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo bash -c 'chmod 640 /home/minio-user/.minio/certs/*'
```
> üîê **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –ª–∏—à–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É minio-user. –¶–µ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ TLS.

10. –î–æ–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä ```UMask``` –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É:

–í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª —Å–µ—Ä–≤—ñ—Å—É:

```bash
sudo nano /lib/systemd/system/minio.service
```

–î–æ–¥–∞–π—Ç–µ –≤ —Å–µ–∫—Ü—ñ—é ```[Service]``` –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫:

```bash
UMask=027
```

–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —é–Ω—ñ—Ç–∏ ```systemd```, —â–æ–± –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏:

```bash
sudo systemctl daemon-reload
```

11. –£–≤—ñ–º–∫–Ω—ñ—Ç—å —ñ –∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å MinIO:

```bash
sudo systemctl enable --now minio
```

12. –ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤—ñ—Å—É, –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä —ñ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –∞–¥—Ä–µ—Å–æ—é:

```bash
https://<MINIO-SERVER-ADDRESS>:9001
```

–£–≤—ñ–π–¥—ñ—Ç—å –¥–æ MinIO Console, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ª–æ–≥—ñ–Ω —ñ –ø–∞—Ä–æ–ª—å, –≤–∫–∞–∑–∞–Ω—ñ —É —Ñ–∞–π–ª—ñ:

```bash
/etc/default/minio

MINIO_ROOT_USER
MINIO_ROOT_PASSWORD
```

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è MinIO bucket

*MinIO –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å—É—Ç–Ω—ñ—Å—Ç—å bucket –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –æ–±‚Äô—î–∫—Ç—ñ–≤. –û–¥–∏–Ω bucket –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–±‚Äô—î–∫—Ç—ñ–≤.*

1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ bucket
–ü–µ—Ä–µ–π–¥—ñ—Ç—å —É –º–µ–Ω—é:

**```Administrator ‚Üí Buckets ‚Üí Create Bucket```**
<br>

![](04-minio-image/image.png)

–£ –ø–æ–ª—ñ —ñ–º–µ–Ω—ñ –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É bucket, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
**```uxp-messagelog```**
<br>
–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **```Create Bucket```**.
<br>

![](04-minio-image/image2.png)

2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–≤–æ—Ç–∏ bucket

*–ü—ñ–¥ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è bucket, –≤–∏ –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É bucket (–∫–≤–æ—Ç—É).*
> ‚ÑπÔ∏è **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ü—ñ—Å–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ—ó –∫–≤–æ—Ç–∏ MinIO –ø–æ—á–∏–Ω–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Ö–∏–ª—è—Ç–∏ –ø–æ–¥–∞–ª—å—à—ñ –∑–∞–ø–∏—Ç–∏ PUT –¥–æ —Ü—å–æ–≥–æ bucket.

–î–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∂–æ—Ä—Å—Ç–∫–æ—ó –∫–≤–æ—Ç–∏ –ø–µ—Ä–µ–π–¥—ñ—Ç—å —É:

**```Administrator ‚Üí Buckets ‚Üí [–≤–∞—à bucket]```**
<br>

![](04-minio-image/image3.png)

–ù–∞ –≤–∫–ª–∞–¥—Ü—ñ ```Summary``` –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Quota``` (—ñ–∫–æ–Ω–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è).
<br>

![](04-minio-image/image4.png)

–ê–∫—Ç–∏–≤—É–π—Ç–µ –ø–µ—Ä–µ–º–∏–∫–∞—á **(ON)**

–í–∫–∞–∂—ñ—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω—É –∫–≤–æ—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 100GiB)

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Save``` 
<br>

![](04-minio-image/image6.png)


## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É –æ–±‚Äô—î–∫—Ç—ñ–≤

*MinIO –¥–æ–∑–≤–æ–ª—è—î –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç—ñ–≤ –ø—ñ—Å–ª—è –∑–∞–¥–∞–Ω–æ–≥–æ —á–∞—Å—É.* <br>
*–°—Ç–∞—Ç—É—Å ```'expiration'``` —ñ–Ω—ñ—Ü—ñ—é—î –¥–ª—è –æ–±‚Äô—î–∫—Ç–∞ –æ–ø–µ—Ä–∞—Ü—ñ—é ```DELETE```. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–∫–µ –ø—Ä–∞–≤–∏–ª–æ –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É, —â–æ–± –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏–º–∏ –≤–≤–∞–∂–∞–ª–∏—Å—å —É—Å—ñ –æ–±‚Äô—î–∫—Ç–∏ —Å—Ç–∞—Ä—à—ñ –Ω—ñ–∂ 365 –¥–Ω—ñ–≤.*

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å —É:
**```Administrator ‚Üí Buckets ‚Üí [–≤–∞—à bucket] ‚Üí Lifecycle```**

2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Add Lifecycle Rule```
<br>

![](04-minio-image/image7.png)

3. –í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 365), –ø—ñ—Å–ª—è —è–∫–∏—Ö –æ–±‚Äô—î–∫—Ç–∏ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ
<br>

![](04-minio-image/image8.png)

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫ –¥–æ—Å—Ç—É–ø—É –¥–æ bucket

*MinIO –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Policy-Based Access Control (PBAC) ‚Äî –ø—Ä–∏ —è–∫–æ–º—É –∫–æ–∂–Ω–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞ –æ–ø–∏—Å—É—î –æ–¥–Ω–µ –∞–±–æ –±—ñ–ª—å—à–µ –ø—Ä–∞–≤–∏–ª, —è–∫—ñ –æ–∫—Ä–µ—Å–ª—é—é—Ç—å –ø—Ä–∏–≤—ñ–ª–µ—ó –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–∏ –≥—Ä—É–ø–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –ø–æ–ª—ñ—Ç–∏–∫, MinIO –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –¥–ª—è S3 –¥—ñ—ó —Ç–∞ —É–º–æ–≤–∏. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ, MinIO –∑–∞–±–æ—Ä–æ–Ω—è—î –¥–æ—Å—Ç—É–ø –¥–æ –¥—ñ–π –∞–±–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ –Ω–µ –æ–ø–∏—Å–∞–Ω–∏—Ö —è–≤–Ω–æ —É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏—Ö —á–∏ —É—Å–ø–∞–¥–∫–æ–≤–∞–Ω–∏—Ö –ø–æ–ª—ñ—Ç–∏–∫–∞—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.*

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å —É:

**```Administrator ‚Üí Policies ‚Üí Create Policy```**
<br>

![](04-minio-image/image9.png)

2. –í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø–æ–ª—ñ—Ç–∏–∫–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

**```uxp-messagelog-policy```**
<br>

![](04-minio-image/image10.png)

3. –£ –ø–æ–ª—ñ –¥–ª—è JSON –≤—Å—Ç–∞–≤—Ç–µ –ø–æ–ª—ñ—Ç–∏–∫—É –Ω–∞ –∑—Ä–∞–∑–æ–∫:

```bash
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": ["s3:PutObject", "s3:GetObject"],
      "Resource": ["arn:aws:s3:::uxp-messagelog/*"]
    }
  ]
}
```

4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Save```.
<br>

![](04-minio-image/image11.png)

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ bucket –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–ª—è –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî –ø—Ä–∏–∑–Ω–∞—á—Ç–µ —Å—Ç–≤–æ—Ä–µ–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –∞–±–æ —Å–µ—Ä–≤—ñ—Å—É.

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –¥–ª—è MinIO

*MinIO –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –∫–ª—ñ—î–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ AWS Signature Version 4. –î–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ S3 API –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –º–∞—Ç–∏ –∫–ª—é—á –¥–æ—Å—Ç—É–ø—É —Ç–∞ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á (—Å–µ—Ä–≤—ñ—Å–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å).*

1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—Ä—É–ø–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
–ü–µ—Ä–µ–π–¥—ñ—Ç—å:

**```Administrator ‚Üí Identity ‚Üí Groups ‚Üí Create Group```**
<br>

![](04-minio-image/image12.png)

–í–∫–∞–∂—ñ—Ç—å –Ω–∞–∑–≤—É –≥—Ä—É–ø–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

**```uxp-security-servers```**
<br>

![](04-minio-image/image13.png)

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Save```
<br>

![](04-minio-image/image14.png)

2. –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏
–ü–µ—Ä–µ–π–¥—ñ—Ç—å —É —â–æ–π–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω—É –≥—Ä—É–ø—É ‚Üí –≤–∫–ª–∞–¥–∫–∞ ```Policies``` ‚Üí ```Set Policies```
<br>

![](04-minio-image/image15.png)

–û–±–µ—Ä—ñ—Ç—å —Ä–∞–Ω—ñ—à–µ —Å—Ç–≤–æ—Ä–µ–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: 
```uxp-messagelog-policy```

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Save```
<br>

![](04-minio-image/image17.png)

3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
–ü–µ—Ä–µ–π–¥—ñ—Ç—å:

**```Administrator ‚Üí Identity ‚Üí Users ‚Üí Create User```**
<br>

![](04-minio-image/image18.png)

–í–≤–µ–¥—ñ—Ç—å —ñ–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

**```uxp-security-server```**

–ó–∞–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å

–û–±–µ—Ä—ñ—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω—É —Ä–∞–Ω—ñ—à–µ –≥—Ä—É–ø—É

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Save```
<br>

![](04-minio-image/image20.png)

4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤ –¥–æ—Å—Ç—É–ø—É
–£ –º–µ–Ω—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Üí –≤–∫–ª–∞–¥–∫–∞ ```Service Accounts``` ‚Üí ```Create Access Key```
<br>

![](04-minio-image/image21.png)

> ‚ö†Ô∏è **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ó–∞–ø–∏—à—ñ—Ç—å –∫–ª—é—á –¥–æ—Å—Ç—É–ø—É —Ç–∞ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á –æ–¥—Ä–∞–∑—É. –í–æ–Ω–∏ –±—ñ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω—ñ!

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Create```
<br>

![](04-minio-image/image22.png)


## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏ UXP

1. –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É MinIO
–°–∫–æ–ø—ñ—é–π—Ç–µ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∑ —Å–µ—Ä–≤–µ—Ä–∞ MinIO (/home/minio-user/.minio/certs/public.crt) –Ω–∞ –®–ë–û:

```bash
scp 192.168.0.20:~/public.crt 192.168.0.10:~
```

–ü–µ—Ä–µ–º—ñ—Å—Ç—ñ—Ç—å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –¥–æ —Ü—ñ–ª—å–æ–≤–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó:

```bash
sudo mv public.crt /etc/uxp/ssl/minio.crt
```

2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∞–≤
–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown uxp:uxp /etc/uxp/ssl/minio.crt
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo chmod 640 /etc/uxp/ssl/minio.crt
```

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó UXP (–¥–ª—è –≤–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ–≥–æ –®–ë–û)
–Ø–∫—â–æ —Å–µ—Ä–≤–µ—Ä –±–µ–∑–ø–µ–∫–∏ –≤–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –≤–Ω–µ—Å—ñ—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ MinIO —É —Ñ–∞–π–ª /etc/uxp/conf.d/local.ini

1. –ü—Ä–∏–∑—É–ø–∏–Ω—ñ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ:

```bash
sudo uxp-integrity pause
```

2. –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª:

```bash
sudo nano /etc/uxp/conf.d/local.ini
```

–î–æ–¥–∞–π—Ç–µ –±–ª–æ–∫:

```bash
[message-log-s3]
address = https://192.168.0.1:9000
bucket-name = uxp-messagelog
access-key = VbiHNrnKWXdazb2mxe4K
secret-key = jQfr1MqMexh9svOWHDJ8EprNriiE9lBgOL0zG0KV
trusted-certificate = /etc/uxp/ssl/minio.crt
```

> ‚ÑπÔ∏è **–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**
> 
> **address** ‚Äî URL –¥–æ MinIO (–∑ –ø–æ—Ä—Ç–æ–º 9000 –∞–±–æ –∑–º—ñ–Ω–µ–Ω–∏–º) <br>
> **bucket-name** ‚Äî –Ω–∞–∑–≤–∞ —Ä–∞–Ω—ñ—à–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ bucket (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, uxp-messagelog) <br>
> **access-key / secret-key** ‚Äî –∫–ª—é—á—ñ —Ä–∞–Ω—ñ—à–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ <br>
> **trusted-certificate** ‚Äî —à–ª—è—Ö –¥–æ TLS-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ /home/minio-user/.minio/certs/public.crt) –°–∫–æ–ø—ñ—é–π—Ç–µ —Ñ–∞–π–ª –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –Ω–∞ –®–ë–û

3. –û–Ω–æ–≤—ñ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Ö–µ—à—ñ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ::

```bash
sudo uxp-integrity update
```
