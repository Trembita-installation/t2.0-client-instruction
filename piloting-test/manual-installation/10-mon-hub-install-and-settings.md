# –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è MonHub-–∫–ª—ñ—î–Ω—Ç–∞

> üõ†Ô∏è **–¶–µ —Ä—ñ—à–µ–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –Ω–∞ –≤—Å—ñ —Å–µ—Ä–≤–µ—Ä–∏, —â–æ –±–µ—Ä—É—Ç—å —É—á–∞—Å—Ç—å —É –ø—ñ–ª–æ—Ç—É–≤–∞–Ω–Ω—ñ (–∫—Ä—ñ–º –∞–¥–º—ñ–Ω-—Å—Ç–∞–Ω—Ü—ñ–π).**
>
> üìÑ –£—Å—ñ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –Ω–∞–¥–∞–ª–∏ –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ –∑–≥–æ–¥–∏ –Ω–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥, —ñ –¥–∞–Ω—ñ –∑–±–∏—Ä–∞—é—Ç—å—Å—è –≤–∏–∫–ª—é—á–Ω–æ –≤ –º–µ–∂–∞—Ö —Ü–∏—Ö –∑–≥–æ–¥.

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `zabbix-agent2` —É —Ä–µ–∂–∏–º—ñ **active checks**, –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—é —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—î—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ —á–µ—Ä–µ–∑ `HostMetadata`.

---

## ‚úÖ 1. Zabbix agent2 (Ubuntu 22.04)

### üîπ 1.1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Zabbix Agent2

```bash
wget https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_7.0-1+ubuntu22.04_all.deb
sudo dpkg -i zabbix-release_7.0-1+ubuntu22.04_all.deb
sudo apt update
sudo apt install zabbix-agent2
```

> üí° –ü–∞–∫–µ—Ç–∏ —Ç–∞–∫–æ–∂ –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ —É –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –¢—Ä–µ–º–±—ñ—Ç–∞.

---

### üîπ 1.2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Zabbix Agent2

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:

```bash
sudo nano /etc/zabbix/zabbix_agent2.conf
```

#### –û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:

```ini
PidFile=/var/run/zabbix/zabbix_agent2.pid
LogFile=/var/log/zabbix/zabbix_agent2.log
LogFileSize=0

ServerActive=zabt2.trembita.gov.ua
HostnameItem=system.hostname
HostMetadata=type={{ zabbix_client_type }};component={{ zabbix_component }};org={{ zabbix_org }}

TLSConnect=psk
TLSAccept=psk
TLSPSKIdentity=psk-client-identity
TLSPSKFile=/etc/zabbix/zabbix_agent2.psk

Include=/etc/zabbix/zabbix_agent2.d/*.conf
PluginSocket=/run/zabbix/agent.plugin.sock
ControlSocket=/run/zabbix/agent.sock
Include=/etc/zabbix/zabbix_agent2.d/plugins.d/*.conf
```

> üìå **HostMetadata** –ø–æ–≤–∏–Ω–µ–Ω –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ —à–∞–±–ª–æ–Ω–∞–º `autoregistration`:
> - `type`: `heavy` –∞–±–æ `light`:  
>    - `heavy` ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä—ñ–≤ —ñ–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏
>    - `light` ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä—ñ–≤ —ñ–∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏
> - `component`: `ss`, `minio`, `ek`, `graylog`, `zabbix`  
> - `org`: –∫–æ–¥ –Ñ–î–†–ü–û–£


> üí° **–ü—Ä–∏–∫–ª–∞–¥ HostMetadata –¥–ª—è —Å–µ—Ä–≤–µ—Ä—É MinIO:** <br>
> HostMetadata=type=heavy;component=minio;org=43395033

---

### üîπ 1.3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —ñ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫

```bash
sudo systemctl restart zabbix-agent2
sudo systemctl enable zabbix-agent2
```
---

### üîπ 1.4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤ –∞–≥–µ–Ω—Ç–∞

```bash
tail -f /var/log/zabbix/zabbix_agent2.log
```

–û—á—ñ–∫—É–≤–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:

```
active checks on server [194.42.200.134:10051]: OK
sending metadata: type=heavy;component=ss;org=43395033
```

---

### üîπ 1.5. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è TLS (PSK)

1. –û—Ç—Ä–∏–º–∞–π—Ç–µ –∫–ª—é—á `PSK` –≤—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –ó–±–µ—Ä–µ–∂—ñ—Ç—å –π–æ–≥–æ –≤ —Ñ–∞–π–ª:

```bash
/etc/zabbix/zabbix_agent2.psk
```

2. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É:

```bash
chown zabbix:zabbix /etc/zabbix/zabbix_agent2.psk
chmod 600 /etc/zabbix/zabbix_agent2.psk
```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –∞–≥–µ–Ω—Ç–∞:

```bash
sudo systemctl restart zabbix-agent2
```

### ‚ÑπÔ∏è –û—á—ñ–∫—É–≤–∞–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É –∞–≥–µ–Ω—Ç:

- –Ω–∞–¥—Å–∏–ª–∞—î —Å–≤–æ—î —ñ–º‚Äô—è —Ö–æ—Å—Ç–∞ —Ç–∞ –º–µ—Ç–∞–¥–∞–Ω—ñ;
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ—î—Å—Ç—Ä—É—î—Ç—å—Å—è –Ω–∞ Zabbix-—Å–µ—Ä–≤–µ—Ä—ñ;
- –æ—Ç—Ä–∏–º—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π —à–∞–±–ª–æ–Ω (`heavy` –∞–±–æ `light`);
- –ø–æ—Ç—Ä–∞–ø–ª—è—î –¥–æ 3 –≥—Ä—É–ø: –∑–∞ —Ç–∏–ø–æ–º, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º, –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—î—é;
- –º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —Ç–µ–≥–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥—ñ–≤;
- –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –∑–∞—Ö–∏—â–µ–Ω–µ TLS-–∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º (PSK).

---

## ‚úÖ 2. Filebeat

> Filebeat –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –ø–æ–¥—ñ–π –∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —Å–∏—Å—Ç–µ–º–∏ –¥–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥-—Å—Ö–æ–≤–∏—â–∞ (Elasticsearch).  
> –ú–∏ –∑–±–∏—Ä–∞—î–º–æ –ª–∏—à–µ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ —Ç–∏–ø–∏ –ª–æ–≥—ñ–≤. –õ–æ–≥–∏ –∑ –∞–¥–º—ñ–Ω-—Å—Ç–∞–Ω—Ü—ñ–π **–Ω–µ –∑–±–∏—Ä–∞—é—Ç—å—Å—è**.

### üîπ 2.1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Filebeat

```bash
curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.18.1-amd64.deb
sudo dpkg -i filebeat-8.18.1-amd64.deb
```

---

### üîπ 2.2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª:

```bash
sudo nano /etc/filebeat/filebeat.yml
```

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–π —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —è–∫–∏–π:
- –∑–±–∏—Ä–∞—î –ª–æ–≥–∏ `syslog`, `postgresql`, `uxp`;
- –≤–∏–∫–ª—é—á–∞—î —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π —à—É–º (CRON, audit, NetworkManager —Ç–æ—â–æ);
- –∑–±–µ—Ä—ñ–≥–∞—î –∫–ª—é—á–æ–≤—ñ –ø–æ–ª—è: `project_id`, `host_role`, `log_type`, `log_file`;
- –Ω–∞–¥—Å–∏–ª–∞—î –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ TLS –¥–æ Trembita Elasticsearch.

**–í–∞–∂–ª–∏–≤–æ:** `project_id: "DaVinci"` –º–∞—î –±—É—Ç–∏ –Ω–µ–∑–º—ñ–Ω–Ω–∏–º.

---

### üîπ 2.3. –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –¥–æ–≤—ñ—Ä–∏ —Ç–∞ API –∫–ª—é—á


> üîë **–û—Ç—Ä–∏–º–∞–π—Ç–µ `api_key` —Ç–∞ `ca.crt` –≤—ñ–¥ –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–∏—Å—Ç–µ–º–∏ –¢—Ä–µ–º–±—ñ—Ç–∞.**


1. –î–æ–¥–∞–π—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω–∏–π —Ñ–∞–π–ª CA-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞:

```bash
/etc/filebeat/ca.crt
```

2. –î–æ–¥–∞–π—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω–∏–π API Key –¥–æ `filebeat.yml` –≤ —Å–µ–∫—Ü—ñ—ó `output.elasticsearch`.

---

### üîπ 2.4. –ó–∞–ø—É—Å–∫ Filebeat

```bash
sudo systemctl enable filebeat
sudo systemctl start filebeat
```

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É:

```bash
sudo systemctl status filebeat
tail -f /var/log/filebeat/filebeat
```

---

## ‚úÖ 3. –ü—ñ–¥—Å—É–º–∫–∏ —â–æ–¥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

- –õ–æ–≥–∏ –∑–±–∏—Ä–∞—é—Ç—å—Å—è –ª–∏—à–µ –Ω–∞ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.
- –£—Å—ñ –∂—É—Ä–Ω–∞–ª–∏ ‚Äî –≤ –º–µ–∂–∞—Ö –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö –∑–≥–æ–¥ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π.
- MonHub –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ –ø—ñ–¥ —á–∞—Å –ø—ñ–ª–æ—Ç—É**.

---

## ‚ÑπÔ∏è –î–æ–¥–∞—Ç–∫–æ–≤–æ

- **–ñ—É—Ä–Ω–∞–ª–∏ –∑ –∞–¥–º—ñ–Ω-—Å—Ç–∞–Ω—Ü—ñ–π –Ω–µ –∑–±–∏—Ä–∞—é—Ç—å—Å—è.**
- –£—Å—ñ –¥–∞–Ω—ñ ‚Äî –ª–∏—à–µ –≤ –º–µ–∂–∞—Ö –ø–æ–≥–æ–¥–∂–µ–Ω–æ–≥–æ –∑ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è–º–∏ –ø–µ—Ä–µ–ª—ñ–∫—É.
- MonHub –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ –ø—ñ–¥ —á–∞—Å **–ø—ñ–ª–æ—Ç—É** –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏.
