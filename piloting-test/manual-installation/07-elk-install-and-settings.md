# –Ü–Ω—Å—Ç–∞–ª—è—Ü—ñ—è —Å–µ—Ä–≤–µ—Ä—É –∞–Ω–∞–ª—ñ–∑—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π ELK

## üîπ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è ELK: –û–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

–®–ë–û —Å—Ç–≤–æ—Ä—é—î –∑–∞–ø–∏—Å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É —â–æ–¥–æ –æ–±–º—ñ–Ω—É –¥–∞–Ω–∏–º–∏ –º—ñ–∂ –®–ë–û. –¶—ñ –∑–∞–ø–∏—Å–∏ –∫–µ—à—É—é—Ç—å—Å—è –≤ –±—É—Ñ–µ—Ä—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É (—Ä–æ–∑–º—ñ—â–µ–Ω–æ–º—É –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ñ–π –ø–∞–º‚Äô—è—Ç—ñ) —ñ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –∞–≥–µ–Ω—Ç –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É (PMA) –¥–ª—è –Ω–∞–∫–æ–ø–∏—á–µ–Ω–Ω—è —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö. –£—Å–ø—ñ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω—ñ –∑–∞–ø–∏—Å–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –∑ –±—É—Ñ–µ—Ä—É –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É.

–î–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –ø–µ—Ä–µ–¥–∞–π—Ç–µ —ó—Ö –∑ PMA –¥–æ Elasticsearch. –í–∏ –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–æ–≤–∏–π —Å–µ—Ä–≤–µ—Ä Elasticsearch/Kibana –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–∞—è–≤–Ω–∏–π. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –π–æ–≥–æ –∫–æ—Ä–µ–∫—Ç–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ PMA.

---

## üîß –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### üîê –ü–æ—Ä—Ç–∏ –¥–æ—Å—Ç—É–ø—É –¥–ª—è –≤—Ö—ñ–¥–Ω–∏—Ö –∑‚Äô—î–¥–Ω–∞–Ω—å Graylog

| –ü–æ—Ä—Ç (TCP) | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –û–±–ª–∞—Å—Ç—å –º–µ—Ä–µ–∂—ñ |
| ---------- | ----------- | -------------- |
| 5601       | –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å Kibana | –ü–†–ò–í–ê–¢–ù–ê |
| 9200       | –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ PMA –¥–æ Elasticsearch (REST API). –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–±–æ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –®–ë–û | –ü–†–ò–í–ê–¢–ù–ê |

---

## üîπ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –ó–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó:

```bash
sudo sed -i 's/^[A-Za-z0-9]/#&/' /etc/apt/sources.list
```
2. –î–æ–¥–∞–π—Ç–µ GPG-–∫–ª—é—á –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

```bash
wget -O - https://project-repo.trembita.gov.ua:8081/public-keys/public.key.txt | sudo apt-key add -
```
3. –î–æ–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:

```bash
echo 'deb https://project-repo.trembita.gov.ua:8081/repository/tr-2-pre-final/ jammy main' | sudo tee -a /etc/apt/sources.list
```
4. –û–Ω–æ–≤—ñ—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç—ñ–≤:

```bash
sudo apt update
```
---

## üîπ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è ELK

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –ø–∞–∫–µ—Ç –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É UXP (–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç–∏ Elasticsearch, Kibana —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏):

```bash
sudo apt install uxp-monitor-analytics
```

2. –ó–±–µ—Ä–µ–∂—ñ—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å –Ω–∞ –µ—Ç–∞–ø—ñ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
--------------------------- Security autoconfiguration information ------------------------------

Authentication and authorization are enabled.
TLS for the transport and HTTP layers is enabled and configured.

The generated password for the elastic built-in superuser is : ******************
```

3. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª Elasticsearch ```/etc/elasticsearch/elasticsearch.yml``` –º—ñ—Å—Ç–∏—Ç—å —Ç–∞–∫—ñ –∑–∞–ø–∏—Å–∏, –¥–æ–¥–∞–Ω—ñ –ø–∞–∫–µ—Ç–æ–º ```uxp-monitor-analytics```:

```bash
cluster.name: uxp
node.name: ${HOSTNAME}
network.host: 0.0.0.0
search.max_buckets: 20000
```

4. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ, —Å–µ—Ä–≤–µ—Ä Kibana –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –Ω–∞ –∞–¥—Ä–µ—Å—É ```localhost```, —â–æ –æ–∑–Ω–∞—á–∞—î –Ω–µ–º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –Ω—å–æ–≥–æ –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –º–∞—à–∏–Ω. –©–æ–± –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –ø—ñ–¥‚Äô—î–¥–Ω–∞–Ω–Ω—è –≤—ñ–¥ –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Å–∫–æ—Ä–∏–≥—É–π—Ç–µ —Ñ–∞–π–ª ```/etc/kibana/kibana.yml```.

```bash
sudo nano /etc/kibana/kibana.yml
```

–†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä ```server.host``` —ñ –∑–º—ñ–Ω—ñ—Ç—å –π–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ ```localhost``` –Ω–∞ –Ω–µ-–∑–∞—Ü–∏–∫–ª–µ–Ω—É IP –∞–¥—Ä–µ—Å—É:

```bash
server.host: 0.0.0.0
```

5. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–º—ñ–Ω –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å–∏:

```bash
sudo systemctl restart elasticsearch kibana
```

6. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å Kibana –¥–æ—Å—Ç—É–ø–Ω–∏–π —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –∑–∞ –∞–¥—Ä–µ—Å–æ—é:

```bash
http://\<server-address\>:5601
```

8. –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ Kibana –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ—ó –∫–æ–º–∞–Ω–¥–∏:

```bash
sudo /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
```

> üîê **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –¶–µ–π —Ç–æ–∫–µ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ –ø—Ä–∏ –ø–µ—Ä–≤–∏–Ω–Ω–æ–º—É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ Kibana —ñ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –ø–æ–¥–∞–ª—å—à–∏—Ö –≤—Ö–æ–¥—ñ–≤.


9. –£ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ Kibana –≤—Å—Ç–∞–≤—Ç–µ —â–æ–π–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Configure Elastic```.

<img src="07-elk-image/image.png" width="300"/>

10. –û—Ç—Ä–∏–º–∞–π—Ç–µ –∫–æ–¥ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó Kibana –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ—ó –∫–æ–º–∞–Ω–¥–∏:

```bash
sudo /usr/share/kibana/bin/kibana-verification-code
```

<img src="07-elk-image/image1.png" width="300"/>

11. –£ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ Kibana –≤—Å—Ç–∞–≤—Ç–µ —â–æ–π–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–∏–π –∫–æ–¥ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Verify```.

12. –£ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ Kibana –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á: ```elastic``` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ ```—Ä–∞–Ω—ñ—à–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π``` –ø–∞—Ä–æ–ª—å.

> ‚ÑπÔ∏è  **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –©–æ–± –∑–º—ñ–Ω–∏—Ç–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å –¥–ª—è –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ —Å—É–ø–µ—Ä-–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ elastic, –∑–∞–ø—É—Å—Ç—ñ—Ç—å —Ç–∞–∫—É –∫–æ–º–∞–Ω–¥—É:
>
> ```bash
> sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic -i
> ```

<img src="07-elk-image/image2.png" width="500"/>

---

## üîπ –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ç—Ä–∞—Ñ—ñ–∫—É –º—ñ–∂ –≤–µ–±–±—Ä–∞—É–∑–µ—Ä–æ–º —Ç–∞ Kibana

–©–æ–± –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ HTTPS –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –º—ñ–∂ –≤–µ–±–±—Ä–∞—É–∑–µ—Ä–æ–º —Ç–∞ Kibana, —Å–ø–µ—Ä—à—É –æ—Ç—Ä–∏–º–∞–π—Ç–µ —á–∏–Ω–Ω–∏–π TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä—É Kibana.

> ‚ö†Ô∏è **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –≤—ñ–¥ –∑–∞–≥–∞–ª—å–Ω–æ–≤—ñ–¥–æ–º–∏—Ö —Ü–µ–Ω—Ç—Ä—ñ–≤ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (CA), –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –∞–±–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ CA, –∞–±–æ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏.

---
### ‚ö†Ô∏è –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É

–í–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏: 

```bash
sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert \
--pem --self-signed --name kibana-server --dns <server-DNS-address> \
--ip <server-IP-address> --days 3650
```

-name ‚Äî –≤–∏–∑–Ω–∞—á–∞—î –Ω–∞–∑–≤—É –∑–∞–ø–∏—Ç—É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É, —è–∫–∏–π –±—É–¥–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ
-dns —Ç–∞ --ip –¥–æ–¥–∞—Ç–∫–æ–≤–æ –º–æ–∂—É—Ç—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ, DNS –Ω–∞–∑–≤–∏ —ñ IP –∞–¥—Ä–µ—Å–∏ —É –≤–∏–≥–ª—è–¥—ñ —Ä–æ–∑–¥—ñ–ª–µ–Ω–æ–≥–æ –∫–æ–º–∞–º–∏ —Å–ø–∏—Å–∫—É, –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏—Ö –Ω–∞–∑–≤ —Å—É–±‚Äô—î–∫—Ç–∞ (SAN, Subject Alternative Name).

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ, –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏ –∫–ª—é—á–∞ —ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É (*kibana-server.key* —Ç–∞ *kibana-server.crt)* –∑–∞–ø–∞–∫–æ–≤–∞–Ω–æ —É —Ñ–∞–π–ª ```/usr/share/elasticsearch/certificate-bundle.zip```

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–¥–æ–±—É—Ç–∏ —Ü—ñ —Ñ–∞–π–ª–∏ —É –∫–∞—Ç–∞–ª–æ–≥ ```./kibana-server``` –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ—ó –∫–æ–º–∞–Ω–¥–∏:

```bash
sudo unzip /usr/share/elasticsearch/certificate-bundle.zip
```

---

1. –î–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ç—Ä–∞—Ñ—ñ–∫—É —Å–∫–æ–ø—ñ—é–π—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω—ñ —Ñ–∞–π–ª–∏ TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É —ñ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, ```kibana-server.crt``` —Ç–∞ ```kibana-server.key```, —É –∫–∞—Ç–∞–ª–æ–≥ ```/etc/kibana/``` –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Kibana.

> ‚ö†Ô∏è –Ø–∫—â–æ –≤–∏ –≥–µ–Ω–µ—Ä—É–≤–∞–ª–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ —á–µ—Ä–µ–∑ ```elasticsearch-certutil```, –ø–µ—Ä–µ–º—ñ—Å—Ç—ñ—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ—ó –∫–æ–º–∞–Ω–¥–∏:
> ```bash
> sudo mv ./kibana-server/kibana-server.* /etc/kibana/
> ```

2. –ó–∞–¥–∞–π—Ç–µ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–ª—è —Ñ–∞–π–ª—ñ–≤:

–ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo bash -c 'chown root:kibana /etc/kibana/kibana-server.*'
```

–ó–º—ñ–Ω—é—î–º–æ –ø—Ä–∏–≤—ñ–ª–µ—ó:

```bash
sudo bash -c 'chmod 640 /etc/kibana/kibana-server.*'
```

3. –ù–∞ —Å–µ—Ä–≤–µ—Ä—ñ Kibana, –≤—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª ```/etc/kibana/kibana.yml```

```bash
sudo nano /etc/kibana/kibana.yml
```

–î–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ —Ä—è–¥–∫–∏, —â–æ–± –≤–≤—ñ–º–∫–Ω—É—Ç–∏ TLS –¥–ª—è –≤—Ö—ñ–¥–Ω–∏—Ö –∑‚Äô—î–¥–Ω–∞–Ω—å —Ç–∞ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —à–ª—è—Ö–∏ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É —Å–µ—Ä–≤–µ—Ä—É —Ç–∞ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞:

```bash
server.ssl.enabled: true
server.ssl.certificate: /etc/kibana/kibana-server.crt
server.ssl.key: /etc/kibana/kibana-server.key
```

4. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Kibana –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ—ó –∫–æ–º–∞–Ω–¥–∏:

```bash
sudo systemctl restart kibana
```

> ‚ÑπÔ∏è **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü–∏—Ö –∑–º—ñ–Ω, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–≤–∂–¥–∏ –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è –¥–æ Kibana —á–µ—Ä–µ–∑ HTTPS ```https://\<server-address\>:5601```

---

## üîπ –ó‚Äô—î–¥–Ω–∞–Ω–Ω—è Elasticsearch —ñ–∑ –∞–≥–µ–Ω—Ç–æ–º –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É (PMA)

–î–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ Elasticsearch, –∞–≥–µ–Ω—Ç PMA –ø–æ—Ç—Ä–µ–±—É—î:

- —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó,
- –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å—É —ñ–Ω–¥–µ–∫—Å—ñ–≤ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É.


### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Elasticsearch –¥–ª—è –∞–≥–µ–Ω—Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É (PMA)

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É —Ä–æ–ª—å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ PMA, –ø–µ—Ä–µ–π—à–æ–≤—à–∏ —É ```Management``` ‚Üí ```Stack Management``` ‚Üí ```Security``` ‚Üí ```Roles``` —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—É–≤—à–∏ ```Create role```.

![](07-elk-image/image6.png)

2. –í–≤–µ–¥—ñ—Ç—å:
   –Ω–∞–∑–≤—É —Ä–æ–ª—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: ```uxp_pma_client```
   –æ–ø–∏—Å —Ä–æ–ª—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: ```Grants privileges to UXP PMA```

3. –£ —Å–µ–∫—Ü—ñ—ó ```Cluster privileges``` —Ä–æ–∑–¥—ñ–ª—É Elasticsearch, –æ–±–µ—Ä—ñ—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –ø—Ä–∏–≤—ñ–ª–µ–π:

   ```monitor```

4. –£ —Å–µ–∫—Ü—ñ—ó ```Index privileges``` —Ä–æ–∑–¥—ñ–ª—É Elasticsearch, –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —ñ–Ω–¥–µ–∫—Å—É –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
   ```uxp-request\*```
   —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó: ```create_index, manage, read, view_index_metadata, write```.
   –î–∞–ª—ñ, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Create role```.

![](07-elk-image/image10.png)

5. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –ø–µ—Ä–µ–π—à–æ–≤—à–∏ —É ```Management``` ‚Üí ```Stack Management``` ‚Üí ```Security``` ‚Üí ```Users``` —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—É–≤—à–∏ ```Create user```/

![](07-elk-image/image11.png)

6. –í–≤–µ–¥—ñ—Ç—å:
   - —ñ–º‚Äô—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: ```uxp_pma```
   - –í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å
   - —ñ –æ–±–µ—Ä—ñ—Ç—å —Ä–∞–Ω—ñ—à–µ —Å—Ç–≤–æ—Ä–µ–Ω—É —Ä–æ–ª—å, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: ```uxp_pma_client```
   –î–∞–ª—ñ, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ```Create user```

![](07-elk-image/image12.png)

---

## üîπ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–≥–µ–Ω—Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É (PMA)
















–ù–∞ –®–ë–û —É–≤—ñ–º–∫–Ω—ñ—Ç—å –ø–µ—Ä–µ–¥–∞—á—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–∞–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä Elasticsearch:

1. –°–∫–æ–ø—ñ—é–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç CA /etc/elasticsearch/certs/http_ca.crt –∑ —Å–µ—Ä–≤–µ—Ä—É Elasticsearch —É –∫–∞—Ç–∞–ª–æ–≥ /etc/uxp/ssl —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏.

> **–ù–∞–ø—Ä–∏–∫–ª–∞–¥** —Å–∫–æ–ø—ñ—é—î–º–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é SCP
>
> 1. –°–∫–æ–ø—ñ—é–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç CA:
>
> ```bash
> sudo cp /etc/elasticsearch/certs/http_ca.crt .
> ```
>
> 2. –ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:
>
> ```bash
> sudo chown $USER:$USER http_ca.crt
> ```
>
> 3. –ü–µ—Ä–µ–¥–∞—î–º–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç CA —á–µ—Ä–µ–∑ SCP:
>
> ```bash
> scp user@192.168.0.30:~/http_ca.crt user@192.168.0.20:~
> ```
>
> **–ù–∞ –®–ë–û** –ø–µ—Ä–µ–º—ñ—Å—Ç–∏–º–æ –≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥:
>
> ```bash
> sudo mv http_ca.crt /etc/uxp/ssl/
> ```

2. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Ü—å–æ–º—É —Ñ–∞–π–ª—É –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–æ–∑–≤–æ–ª–∏.
   –ó–º—ñ–Ω—é—î–º–æ –≤–ª–∞—Å–Ω–∏–∫–∞:

```bash
sudo chown root:uxp /etc/uxp/ssl/http_ca.crt
```

—Ç–∞ –¥–æ–∑–≤–æ–ª–∏:

```bash
sudo chmod 640 /etc/uxp/ssl/http_ca.crt
```

3. –°–∫–æ—Ä–∏–≥—É–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª /etc/uxp/monitor-agent.ini

a. –ü–µ—Ä—à –Ω—ñ–∂ –∫–æ—Ä–∏–≥—É–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª /etc/uxp/monitor-agent.ini, –ø—Ä–∏–∑—É–ø–∏–Ω—ñ—Ç—å —Ä–æ–±–æ—Ç—É –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –±–µ–∑–ø–µ–∫–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ—ó –∫–æ–º–∞–Ω–¥–∏:

```bash
sudo uxp-integrity pause
```

b. –Ü –ø–æ—Ç—ñ–º —Å–∫–æ—Ä–∏–≥—É–π—Ç–µ /etc/uxp/monitor-agent.ini

```bash
sudo nano /etc/uxp/monitor-agent.ini
```

–¥–æ–¥–∞–≤—à–∏ —É –Ω—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª [elasticsearch] –Ω–∞ –∑—Ä–∞–∑–æ–∫ —Ç–∞–∫–æ–≥–æ:

```bash
[elasticsearch]
address = 192.168.0.30
port = 9200
scheme = https
ca-cert-file = /etc/uxp/ssl/http_ca.crt
username = uxp_pma
password = *******
index = uxp-request
```



| –ü–æ–ª–µ | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è | –ü–æ—è—Å–Ω–µ–Ω–Ω—è |
| --- | --- | --- |
| address |  | –ù–∞–∑–≤–∞ —Ö–æ—Å—Ç—É (—â–æ –≤—ñ–¥–≥—É–∫—É—î—Ç—å—Å—è –Ω–∞ IP –∞–¥—Ä–µ—Å—É —á–µ—Ä–µ–∑ DNS) –∞–±–æ IP –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä—É Elasticsearch. –û–±–æ–≤‚Äô—è–∑–∫–æ–≤–µ. |
| port | 9200 | –ü–æ—Ä—Ç, –Ω–∞ —è–∫–æ–º—É —Å–µ—Ä–≤–µ—Ä Elasticsearch –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—î –∑–∞–ø–∏—Ç–∏. |
| scheme | http | –°—Ö–µ–º–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞ –∑ Elasticsearch –ø–æ HTTP. –ú–æ–∂–ª–∏–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è http –∞–±–æ https. |
| ca-cert-file |  | –ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É (–∑ –ø–æ–≤–Ω–∏–º —à–ª—è—Ö–æ–º) CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É Elasticsearch (—É —Ñ–æ—Ä–º–∞—Ç—ñ PEM –∞–±–æ DER). –û–±–æ–≤‚Äô—è–∑–∫–æ–≤–µ —É –≤–∏–ø–∞–¥–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ö–µ–º–∏ https. –ê–≥–µ–Ω—Ç –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–æ—Ç—Ä–µ–±—É—î —Ü–µ–π CA —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç, —â–æ–± –≤–µ—Ä–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –≤—É–∑–ª–∞ Elasticsearch –ø—ñ–¥ —á–∞—Å TLS —Ä—É–∫–æ—Å—Ç–∏—Å–∫–∞–Ω–Ω—è. |
| username |  | –Ü–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Elasticsearch –¥–ª—è –±–∞–∑–æ–≤–æ—ó –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. –û–±–æ–≤‚Äô—è–∑–∫–æ–≤–µ —É –≤–∏–ø–∞–¥–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.<br /><br />*–ó–∞–±–µ–∑–ø–µ—á—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —É –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Elasticsearch –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –Ω–∞ –≤–∫–∞–∑–∞–Ω–∏–π —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —ñ–Ω–¥–µ–∫—Å.* |
| password |  | –ü–∞—Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Elasticsearch –¥–ª—è –±–∞–∑–æ–≤–æ—ó –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. –û–±–æ–≤‚Äô—è–∑–∫–æ–≤–µ —É –≤–∏–ø–∞–¥–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. |
| index | uxp-request | –ù–∞–∑–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —ñ–Ω–¥–µ–∫—Å—É. –î–æ–¥–∞—Ç–∫–æ–≤–æ, –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ —à–∞–±–ª–æ–Ω –¥–∞—Ç–∏ –¥–ª—è —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö –Ω–∞ –æ–∫—Ä–µ–º—ñ —ñ–Ω–¥–µ–∫—Å–∏. –®–∞–±–ª–æ–Ω–∏ –∑–∞—Å–Ω–æ–≤–∞–Ω—ñ –Ω–∞ –ø—Ä–æ—Å—Ç—ñ–π –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –ª—ñ—Ç–µ—Ä —ñ —Å–∏–º–≤–æ–ª—ñ–≤ –æ–±—Ä–∞–º–ª–µ–Ω–∏—Ö —É —Ñ—ñ–≥—É—Ä–Ω—ñ –¥—É–∂–∫–∏, –ø–µ—Ä–µ–¥ —è–∫–∏–º–∏ —Å—Ç–æ—ó—Ç—å –∑–Ω–∞–∫ –≤—ñ–¥—Å–æ—Ç–∫—É (%{DATE_PATTERN}). –ù–∞–ø—Ä–∏–∫–ª–∞–¥, uxp-%{yyyy.MM.dd}, uxp-%{M.y}-opdata, –¥–µ y –≤–∏–∑–Ω–∞—á–∞—î —Ä—ñ–∫, M –≤–∏–∑–Ω–∞—á–∞—î –º—ñ—Å—è—Ü—å, –∞ d –≤–∏–∑–Ω–∞—á–∞—î –¥–µ–Ω—å –º—ñ—Å—è—Ü—è. –ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —à–∞–±–ª–æ–Ω—É –¥–∞—Ç–∏ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —É —Ä–æ–∑–¥—ñ–ª—ñ "–®–∞–±–ª–æ–Ω–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —ñ –ø–∞—Ä—Å–∏–Ω–≥—É" –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –ø–æ Java [DATE-TIME-FORMATTER]. |

c. –ü—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∞–≥–µ–Ω—Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É:

```bash
sudo reload-monitor-agent
```

4. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω, –æ–Ω–æ–≤—ñ—Ç—å —Ö–µ—à—ñ –∑ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–∞–∫–æ—ó –∫–æ–º–∞–Ω–¥–∏:

```bash
sudo uxp-integrity update
```

> –ê–≥–µ–Ω—Ç –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–≤—ñ–π —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç /etc/uxp/ssl/elasticsearch.crt –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è —ñ–∑ —Å–µ—Ä–≤–µ—Ä–æ–º Elasticsearch.

> –ö–æ–ª–∏ –∞–≥–µ–Ω—Ç –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤–ø–µ—Ä—à–µ –Ω–∞–¥—ñ—à–ª–µ –¥–∞–Ω—ñ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É, –≤—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Elasticsearch –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π —ñ–Ω–¥–µ–∫—Å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, uxp-request).

# **–ö—Ä–æ–∫ 4:** –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Kibana –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏

–î–∞–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤–∫–ª—é—á–∞—é—Ç—å —É —Å–µ–±–µ –∑–∞–ø–∏—Å–∏ –∑ —Å–µ—Ä–≤–µ—Ä—ñ–≤ –±–µ–∑–ø–µ–∫–∏ —è–∫ —ñ–∑ –±–æ–∫—É –∫–ª—ñ—î–Ω—Ç–∞, —Ç–∞–∫ —ñ –∑ –±–æ–∫—É —Å–µ—Ä–≤—ñ—Å—É, –ø–æ–∫–∞–∑—É—é—á–∏ —Ç—É —Å–∞–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –≤–∏–∫–æ–Ω–∞–Ω—É –≤ —Å–∏—Å—Ç–µ–º—ñ. –Ø–∫—â–æ –≤–∏ –ø–æ—Ä–∞—Ö—É—î—Ç–µ –∑–∞–ø–∏—Å–∏ –≤ Kibana, –¥—É–±–ª—ñ–∫–∞—Ç–∏ —Ç–µ–∂ –±—É–¥—É—Ç—å –≤—Ö–æ–¥–∏—Ç–∏ —É –∑–∞–≥–∞–ª—å–Ω–µ —á–∏—Å–ª–æ. –í–∏ –º–æ–∂–µ—Ç–µ —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è, –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—á–∏ –¥–æ –∑–∞–ø–∏—Å—ñ–≤ —Ñ—ñ–ª—å—Ç—Ä, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ —É–º–æ–≤–æ—é –≤–∫–ª—é—á–µ–Ω–Ω—è –ª–∏—à–µ –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö –∑ —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏ –∫–ª—ñ—î–Ω—Ç–∞, —Ç–æ–±—Ç–æ, —Ç–∏—Ö, —â–æ –º–∞—é—Ç—å —É –ø–æ–ª—ñ security_server_type –∑–Ω–∞—á–µ–Ω–Ω—è Client.

## –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö (Data view) —î –Ω–∞–±–æ—Ä–æ–º –¥–∞–Ω–∏—Ö –Ω–∞—è–≤–Ω–∏—Ö –≤ Elasticsearch, —è–∫—ñ –≤–∏ –±–∞–∂–∞—î—Ç–µ –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤ Kibana. –í–æ–Ω–∏ –º–æ–∂—É—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç–∏ —î–¥–∏–Ω–∏–π —ñ–Ω–¥–µ–∫—Å, –∫—ñ–ª—å–∫–∞ —ñ–Ω–¥–µ–∫—Å—ñ–≤, –∞–±–æ –≤—Å—ñ —ñ–Ω–¥–µ–∫—Å–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å –≤–∞—à—ñ –¥–∞–Ω—ñ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É.

> –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤ Kibana –¥–ª—è —ñ–Ω–¥–µ–∫—Å—É, —è–∫–æ–≥–æ —â–µ –Ω–µ —ñ—Å–Ω—É—î –≤ Elasticsearch, –Ω–µ–º–æ–∂–ª–∏–≤–æ.

> **PMA —Å—Ç–≤–æ—Ä—é—î —Å–≤—ñ–π –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π —ñ–Ω–¥–µ–∫—Å –≤ Elasticsearch, –∫–æ–ª–∏ –≤–ø–µ—Ä—à–µ –Ω–∞–¥—Å–∏–ª–∞—î –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ.** –©–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ —ñ—Å–Ω—É—é—á–∏—Ö —ñ–Ω–¥–µ–∫—Å—ñ–≤, –ø–µ—Ä–µ–π–¥—ñ—Ç—å –≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ Kibana —É
> **Management** ‚Üí **Stack Management** ‚Üí **Data** ‚Üí **Index Management**.

<span style="color:red;">*–°—Ç–≤–æ—Ä—ñ—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö, —è–∫—â–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –±—É–ª–æ –∑—ñ–±—Ä–∞–Ω–æ.*</span>

![](07-elk-image/image14.png)

> –ü—ñ–¥ —á–∞—Å —ñ–º–ø–æ—Ä—Ç—É –ø—Ä–∏–∫–ª–∞–¥—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ –∞–±–æ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó UXP, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö uxp-visualizations-index –¥–ª—è —à–∞–±–ª–æ–Ω—É —ñ–Ω–¥–µ–∫—Å—É –¥–∞–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É uxp-request\*, —Ä–∞–∑–æ–º –∑ –ø–æ–ª–µ–º —á–∞—Å—É request_in_ts —ñ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤–∏–º–∏ –ø–æ–ª—è–º–∏, —è–∫—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ–π. –î–ª—è –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∞–±–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ü—ñ–ª–∫–æ–º –Ω–æ–≤–µ.

**–©–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ Kibana, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:**

1\. –ü–µ—Ä–µ–π–¥—ñ—Ç—å —É **Management** ‚Üí **Stack Management** ‚Üí **Kibana** ‚Üí **Data Views** —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å

**Create data view**.

![](07-elk-image/image13.png)

2\. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø–æ–ª—è –ø–æ–¥—ñ–±–Ω–∏–º —á–∏–Ω–æ–º:

a. **Name** - –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: **uxp-request**

b. **Index pattern** ‚Äì –≤–≤–µ–¥—ñ—Ç—å (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —ñ–Ω–¥–µ–∫—Å –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö): **uxp-request**\*

c. **Timestamp field** ‚Äì –æ–±–µ—Ä—ñ—Ç—å **request_in_ts**

3\. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Save data view to Kibana**.

![](07-elk-image/image15.png)

–î–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –ø–µ—Ä–µ–π–¥—ñ—Ç—å —É **Analytics** ‚Üí **Discover** —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —ñ–∑ —Å–ø–∞–¥–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É –ø–æ–ª—è Data view.

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó

–ü–∞–∫–µ—Ç ***uxp-monitor-analytics*** –ø—Ä–æ–ø–æ–Ω—É—î –ø—Ä–∏–∫–ª–∞–¥ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ *uxp-dashboard.ndjson (\[UXP\] Overview)* - —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–æ–≥–æ —É –∫–∞—Ç–∞–ª–æ–∑—ñ:
***/usr/share/doc/uxp-monitor-analytics/examples/kibana 8.x/dashboards***
–¶—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å –º—ñ—Å—Ç–∏—Ç—å –Ω–∞–±—ñ—Ä —Ä—ñ–∑–Ω–∏—Ö –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ–π (—Ç–µ–ø–ª–æ–≤–∞ –∫–∞—Ä—Ç–∞, –≥—Ä–∞—Ñ—ñ–∫–∏, —á–∏—Å–ª–æ–≤–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ç–æ—â–æ).

> –£—Å—ñ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó —É –ø—Ä–∏–∫–ª–∞–¥—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ “ë—Ä—É–Ω—Ç—É—é—Ç—å—Å—è –≤–∏–∫–ª—é—á–Ω–æ –Ω–∞ –¥–∞–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ç–∞ —ó—Ö —à–∞–±–ª–æ–Ω—ñ —ñ–Ω–¥–µ–∫—Å—É *uxp-request*\*.

> –£—Å—ñ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó —É –ø—Ä–∏–∫–ª–∞–¥—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ –≤–∫–ª—é—á–∞—é—Ç—å –∑–∞–ø–∏—Å–∏ —è–∫ –∑ –±–æ–∫—É —Å–µ—Ä–≤–µ—Ä—ñ–≤ –±–µ–∑–ø–µ–∫–∏ –∫–ª—ñ—î–Ω—Ç–∞, —Ç–∞–∫ —ñ –∑ –±–æ–∫—É —Å–µ—Ä–≤–µ—Ä—ñ–≤ –±–µ–∑–ø–µ–∫–∏ —Å–µ—Ä–≤—ñ—Å—É. –©–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —É –ø—ñ–¥—Å—É–º–∫–∞—Ö, –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–π—Ç–µ –∑–∞–ø–∏—Å–∏ –∑–∞ –ø–æ–ª–µ–º —Ç–∏–ø—É —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑–ø–µ–∫–∏ (–ø–æ–ª–µ *security_server_type*).

–©–æ–± —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ –¥–æ Kibana, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:

1. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ñ–∞–π–ª –ø—Ä–∏–∫–ª–∞–¥—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ ***uxp-dashboard.ndjson*** –∑ –∫–∞—Ç–∞–ª–æ–≥—É /usr/share/doc/uxp-monitor-analytics/examples/kibana-8.x/dashboards –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Kibana, –Ω–∞ —Å–≤—ñ–π –∫–æ–º–ø‚Äô—é—Ç–µ—Ä, –¥–µ –≤—ñ–¥–∫—Ä–∏—Ç–æ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å Kibana.

![](07-elk-image/image16.png)

2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å —É **Management** ‚Üí **Stack Management** ‚Üí **Kibana** ‚Üí **Saved Objects** —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **Import**.

![](07-elk-image/image17.png)

3. –û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É.
4. –î–∞–ª—ñ, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å **Import**, –∞ –ø–æ—Ç—ñ–º **Done**.






  

